---
title: "numderivs"
author: "Kun Yang & Alexander Zhu"
date: "1/24/2022"
output: pdf_document
---

```{r}
deriv_m1 <- function(f, x, h=1/256) (f(x+h) - f(x)) / h
deriv_m2 <- function(f, x, h=1/256) (f(x+h) - f(x-h)) / (2*h)
deriv_m3 <- function(f, x, h=1/256) Im(f(complex(real = x, imaginary = h))) / h
```

 We select the method of three numerical approximations to the derivative of a function f at a point $x$ by a step size $h$: (1) the forward difference quotient; (2) the central, or symmetric, difference quotient; (3) approximation with a complex number.   
 $\partial_{F}(f,x,h)$$=$$\frac{f(x+h)-f(x)}{h}$ (1).\
 $\partial_{S}(f,x,h)$$=$$\frac{f(x+h)-f(x-h)}{2h}$ (2).\
 $\partial_{C}(f,x,h)$$=$$\frac{\Im(f(x+hi))}{h}$ (3).\


 We use $h= 2^{-1},...,2^{-64}.$ to examine the 3 approaches. We plot the approximations graphically by the approximations against corresponding $z=-log_{2}h$, $z = 1,2,...,64$.  
 

## 1. f1(x) = sin(x)
 We examine the approximations for the derivative of $f_{1}(x) = sin(x)$ at $x=1$. The true value of derivative of $f_{1}(x)$ is $g_{1}(x) = cos(x)$. It is shown below that several examples for $z$ and corresponding approximations generated by the 3 approaches and the true value is also given:  
 
```{r}
hs <- 2^(-seq(1:64))
z <- -log2(hs)
x <- 1
```

```{r}
f1 <- sin
g1 <- cos

f_ <- f1
g_ <- g1
```

```{r}
deriv_true <- g_(x)
deriv_F <- deriv_m1(f_, x, hs)
deriv_S <- deriv_m2(f_, x, hs)
deriv_C <- deriv_m3(f_, x, hs)
data.frame(z, deriv_true, deriv_F, deriv_S, deriv_C)[seq(1, length(z), 4),]
```

 

```{r}
plot(deriv_F ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_S ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_C ~ z)
abline(deriv_true, 0, col = "red")
```

 Comment: When $z$ increases, the numeric approximations approach the true value. Method (1) and method (2) will lose their precision when introducing very small values of $h$ and finally generate zeros due to the limit of digits on the machine. Method (3) solves this problem and gives an exact approximation to the true value. Additionally, method (2) can give a better approximation when $h$ is relatively large.  



## 2. f2(x) = 10000sin(x)

 We examine the approximations for the derivative of $f_{2}(x) = 10000sin(x)$ at $x=1$. The true value of derivative of $f_{2}(x)$ is $g_{2}(x) = 10000cos(x)$. It is shown below that several examples for $z$ and corresponding approximations generated by the 3 approaches and the true value is also given.:  
 
```{r}
f2 <- function(x) 10000 * sin(x)
g2 <- function(x) 10000 * cos(x)

f_ <- f2
g_ <- g2
x <- 1
```

```{r}
deriv_true <- g_(x)
deriv_F <- deriv_m1(f_, x, hs)
deriv_S <- deriv_m2(f_, x, hs)
deriv_C <- deriv_m3(f_, x, hs)
data.frame(z, deriv_true, deriv_F, deriv_S, deriv_C)[seq(1, length(z), 4),]
```

```{r}
plot(deriv_F ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_S ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_C ~ z)
abline(deriv_true, 0, col = "red")
```

 We can draw the same conclusion as 1.

## 3. f3(x) = tan(x)

 We examine the approximations for the derivative of $f_{3}(x) = tan(x)$ at $x=1.59$. The true value of derivative of $f_{3}(x)$ is $g_{3}(x) = sec(x)^2$. It is shown below that several examples for $z$ and corresponding approximations generated by the 3 approaches and the true value is also given.:  
 
```{r}
f3 <- tan
g3 <- function(x) 1 / cos(x)^2

f_ <- f3
g_ <- g3
x <- 1.59
```

```{r}
deriv_true <- g_(x)
deriv_F <- deriv_m1(f_, x, hs)
deriv_S <- deriv_m2(f_, x, hs)
deriv_C <- deriv_m3(f_, x, hs)
data.frame(z, deriv_true, deriv_F, deriv_S, deriv_C)[seq(1, length(z), 4),]
```

```{r}
plot(deriv_F ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_S ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_C ~ z)
abline(deriv_true, 0, col = "red")
```
 Similar conclusion as 1 is available for 3. But method (2) no longer shows better approximation when $h$ is large.  

## 3. $f_4(x) = \phi(x)$

 We examine the approximations for the derivative of $f_{4}(x) = \phi(x) = \frac{e^{-x^2/2}}{\sqrt{2\pi}}$ at $x=0.5$. The true value of derivative of $f_{4}(x)$ is $g_{4}(x) = \frac{-xe^{-x^2/2}}{\sqrt{2\pi}}$. It is shown below that several examples for $z$ and corresponding approximations generated by the 3 approaches and the true value is also given.:  
 
```{r}
f4 <- dnorm
g4 <- function(x) -x * dnorm(x)
f4 <- function(x) exp(-x^2/2) / sqrt(2*pi)
g4 <- function(x) -x * exp(-x^2/2) / sqrt(2*pi)

f_ <- f4
g_ <- g4
x <- 0.5
```

```{r}
deriv_true <- g_(x)
deriv_F <- deriv_m1(f_, x, hs)
deriv_S <- deriv_m2(f_, x, hs)
deriv_C <- deriv_m3(f_, x, hs)
data.frame(z, deriv_true, deriv_F, deriv_S, deriv_C)[seq(1, length(z), 4),]
```

```{r}
plot(deriv_F ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_S ~ z)
abline(deriv_true, 0, col = "red")
```

```{r}
plot(deriv_C ~ z)
abline(deriv_true, 0, col = "red")
```

 Similar conclusion as 1 is available for 4.  

## Contribution Statement

Both Alex and Kun wrote their own code of the function first and discuss on the final version.

Repository: [kuy003](https://github.com/Kun-Yang-003/FMPH291_WI22_A00_kuy003.git)
